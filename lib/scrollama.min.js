!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.scrollama=t()}(this,function(){"use strict";function e(e){for(var t=e.length,n=[],o=0;o<t;o+=1)n.push(e[o]);return n}function t(e){return e instanceof Element?e:"string"==typeof e?document.querySelector(e):null}function n(e){return"scrollama__debug-step--"+e.id+"-"+e.i}function o(e){return"scrollama__debug-offset--"+e.id}function r(e){var t=e.id,r=e.offsetVal,i=e.stepEl,s=i[0].getAttribute("class");i.forEach(function(e,o){return function(e){var t=n({id:e.id,i:e.i}),o=document.createElement("div");o.setAttribute("id",t+"_above"),o.setAttribute("class","scrollama__debug-step"),o.style.position="fixed",o.style.left="0",o.style.width="100%",o.style.backgroundImage="repeating-linear-gradient(45deg, green 0, green 2px, white 0, white 40px)",o.style.border="2px solid green",o.style.opacity="0.33",o.style.zIndex="9999",o.style.display="none",document.body.appendChild(o);var r=document.createElement("div");r.setAttribute("id",t+"_below"),r.setAttribute("class","scrollama__debug-step"),r.style.position="fixed",r.style.left="0",r.style.width="100%",r.style.backgroundImage="repeating-linear-gradient(135deg, orange 0, orange 2px, white 0, white 40px)",r.style.border="2px solid orange",r.style.opacity="0.33",r.style.zIndex="9999",r.style.display="none",document.body.appendChild(r)}({id:t,i:o})}),function(e){var t=e.id,n=e.offsetVal,r=e.stepClass,i=document.createElement("div");i.setAttribute("id",o({id:t})),i.setAttribute("class","scrollama__debug-offset"),i.style.position="fixed",i.style.left="0",i.style.width="100%",i.style.height="0px",i.style.borderTop="2px dashed black",i.style.zIndex="9999";var s=document.createElement("p");s.innerText='".'+r+'" trigger: '+n,s.style.fontSize="12px",s.style.fontFamily="monospace",s.style.color="black",s.style.margin="0",s.style.padding="6px",i.appendChild(s),document.body.appendChild(i)}({id:t,offsetVal:r,stepClass:s})}function i(e){var t=e.id,r=e.stepOffsetHeight,i=e.offsetMargin;e.offsetVal;r.forEach(function(e,o){return function(e){var t=e.id,o=e.h,r=e.i,i=e.offsetMargin,s=n({id:t,i:r}),c=document.querySelector("#"+s+"_above");c.style.height=o+"px",c.style.top=i-o+"px";var a=document.querySelector("#"+s+"_below");a.style.height=o+"px",a.style.top=i+"px"}({id:t,h:e,i:o,offsetMargin:i})}),function(e){var t=e.id,n=e.offsetMargin,r=(e.offsetVal,o({id:t}));document.querySelector("#"+r).style.top=n+"px"}({id:t,offsetMargin:i})}function s(e){var t=e.id,o=e.index,r=e.state,i=n({id:t,i:o}),s=document.querySelector("#"+i+"_above"),c=document.querySelector("#"+i+"_below"),a="enter"===r?"block":"none";s&&(s.style.display=a),c&&(c.style.display=a)}return function(){var n=1,o={},c={},a=null,u=null,l=null,f=null,d=0,p=0,g=0,v=0,h=null,b=null,x=null,m=!1,y=!1,w=!1,E=!1,A=0,M=!1,I=!1,_=null,C=null,O=-1,P=null,B=[];function S(e){var t=0;if(e.offsetParent)do{t+=e.offsetTop,e=e.offsetParent}while(e);return t<0?0:t}function H(e){return+e.getAttribute("data-scrollama-index")}function k(){window.pageYOffset>O?P="down":window.pageYOffset<O&&(P="up"),O=window.pageYOffset}function q(){var e,t;g=window.innerHeight,e=document.body,t=document.documentElement,v=Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight),x=u?u.getBoundingClientRect():null,p=d*g,h=l?l.map(function(e){return e.offsetHeight}):[],b=l?l.map(S):[],y&&m&&W(),w&&i({id:f,stepOffsetHeight:h,offsetMargin:p,offsetVal:d})}function R(e){e&&!y?(m&&W(),y=!0):e||(c.top&&c.top.disconnect(),c.bottom&&c.bottom.disconnect(),c.stepAbove&&c.stepAbove.forEach(function(e){return e.disconnect()}),c.stepBelow&&c.stepBelow.forEach(function(e){return e.disconnect()}),c.stepProgress&&c.stepProgress.forEach(function(e){return e.disconnect()}),c.viewportAbove&&c.viewportAbove.forEach(function(e){return e.disconnect()}),c.viewportBelow&&c.viewportBelow.forEach(function(e){return e.disconnect()}),y=!1)}function V(e,t){if("above"===t)for(var n=0;n<e;n++){var o=_[n];"enter"===o.state&&j(l[n]),"up"===o.direction&&(T(l[n],"down"),j(l[n]))}else if("below"===t)for(var r=_.length-1;r>e;r--){var i=_[r];"enter"===i.state&&j(l[r]),"down"===i.direction&&(T(l[r],"up"),j(l[r]))}}function T(e,t){void 0===t&&(t=!0);var n=H(e),r={element:e,index:n,direction:P};_[n].direction=P,_[n].state="enter",M&&t&&"down"===P&&V(n,"above"),M&&t&&"up"===P&&V(n,"below"),o.stepEnter&&"function"==typeof o.stepEnter&&!B[n]&&(o.stepEnter(r,_),w&&s({id:f,index:n,state:"enter"}),I&&(B[n]=!0)),E&&z(e,"down"===P?0:1)}function j(e){var t=H(e),n={element:e,index:t,direction:P};_[t].direction=P,_[t].state="exit",E&&z(e,"down"===P?1:0),o.stepExit&&"function"==typeof o.stepExit&&(o.stepExit(n,_),w&&s({id:f,index:t,state:"exit"}))}function z(e,t){var n={element:e,index:H(e),progress:t};o.stepProgress&&"function"==typeof o.stepProgress&&o.stepProgress(n)}function N(){var e={direction:P};C.direction=P,C.state="enter",o.containerEnter&&"function"==typeof o.containerEnter&&o.containerEnter(e)}function Y(){var e={direction:P};C.direction=P,C.state="exit",o.containerExit&&"function"==typeof o.containerExit&&o.containerExit(e)}function F(e){k(),e.forEach(function(e){var t=e.isIntersecting,o=e.boundingClientRect,r=e.target,i=o.bottom,s=o.height,c=i-p,a=H(r),u=_[a];c>=-n&&(t&&"down"===P&&"enter"!==u.state?T(r,P):t||"up"!==P||"enter"!==u.state?!t&&c>=s&&"down"===P&&"enter"===u.state&&j(r):j(r))})}function D(e){k(),e.forEach(function(e){var t=e.isIntersecting,o=e.boundingClientRect,r=e.target,i=o.bottom,s=o.height,c=i-p,a=H(r),u=_[a];c>=-n&&c<s&&t&&"up"===P&&"enter"!==u.state?T(r,P):c<=n&&!t&&"down"===P&&"enter"===u.state&&j(r)})}function L(e){k(),e.forEach(function(e){var t=e.isIntersecting,n=e.target,o=H(n),r=_[o];t&&"down"===P&&"enter"!==r.state&&"down"!==r.direction&&(T(n,"down"),j(n))})}function G(e){k(),e.forEach(function(e){var t=e.isIntersecting,n=e.target,o=H(n),r=_[o];t&&"up"===P&&"enter"!==r.state&&"up"!==r.direction&&(T(n,"up"),j(n))})}function J(e){k(),e.forEach(function(e){var t=e.isIntersecting,o=e.intersectionRatio,r=e.boundingClientRect,i=e.target,s=r.bottom;t&&s-p>=-n&&z(i,+o.toFixed(3))})}function K(e){k();var t=e[0],o=t.isIntersecting,r=t.boundingClientRect;r.top,r.bottom>-n&&(o?N():"enter"===C.state&&Y())}function Q(e){k();var t=e[0],o=t.isIntersecting;t.boundingClientRect.top<n&&(o?N():"enter"===C.state&&Y())}function U(){c.stepProgress&&c.stepProgress.forEach(function(e){return e.disconnect()}),c.stepProgress=l.map(function(e,t){var n=h[t]-p+"px 0px "+(-g+p)+"px 0px",o=function(e){for(var t=Math.ceil(e/A),n=[],o=1/t,r=0;r<t;r++)n.push(r*o);return n}(h[t]),r=new IntersectionObserver(J,{root:null,rootMargin:n,threshold:o});return r.observe(e),r})}function W(){c.viewportAbove&&c.viewportAbove.forEach(function(e){return e.disconnect()}),c.viewportAbove=l.map(function(e,t){var n=b[t],o=-(g-p+h[t]),r=new IntersectionObserver(L,{root:null,rootMargin:n+"px 0px "+o+"px 0px",threshold:0});return r.observe(e),r}),c.viewportBelow&&c.viewportBelow.forEach(function(e){return e.disconnect()}),c.viewportBelow=l.map(function(e,t){var n=-(p+h[t]),o=v-b[t]-h[t]-p,r=new IntersectionObserver(G,{root:null,rootMargin:n+"px 0px "+o+"px 0px",threshold:0});return r.observe(e),r}),c.stepAbove&&c.stepAbove.forEach(function(e){return e.disconnect()}),c.stepAbove=l.map(function(e,t){var n=h[t],o=new IntersectionObserver(F,{root:null,rootMargin:n+"px 0px "+(-g+p)+"px 0px",threshold:0});return o.observe(e),o}),c.stepBelow&&c.stepBelow.forEach(function(e){return e.disconnect()}),c.stepBelow=l.map(function(e,t){var n=-p,o=v-g+h[t]+p,r=new IntersectionObserver(D,{root:null,rootMargin:n+"px 0px "+o+"px 0px",threshold:0});return r.observe(e),r}),E&&U(),a&&u&&(function(){c.top&&c.top.unobserve(a);var e={root:null,rootMargin:g+"px 0px -"+g+"px 0px",threshold:0};c.top=new IntersectionObserver(K,e),c.top.observe(a)}(),function(){c.bottom&&c.bottom.unobserve(a);var e={root:null,rootMargin:"-"+x.height+"px 0px "+x.height+"px 0px",threshold:0};c.bottom=new IntersectionObserver(Q,e),c.bottom.observe(a)}())}var X={};return X.setup=function(n){var o=n.container,i=n.graphic,s=n.step,c=n.offset;void 0===c&&(c=.5);var p=n.progress;void 0===p&&(p=!1);var g=n.threshold;void 0===g&&(g=4);var v=n.debug;void 0===v&&(v=!1);var h=n.order;void 0===h&&(h=!0);var b,x,y,O,P,B=n.once;return void 0===B&&(B=!1),x=(b="abcdefghijklmnopqrstuv").length,y=(new Date).getTime(),f=""+[0,0,0].map(function(e){return b[Math.floor(Math.random()*x)]}).join("")+y,O=s,void 0===P&&(P=document),l="string"==typeof O?e(P.querySelectorAll(O)):O instanceof NodeList?e(O):O instanceof Array?O:[],a=o?t(o):null,u=i?t(i):null,l.length?(w=v,E=p,M=h,I=B,X.offsetTrigger(c),A=Math.max(1,+g),m=!0,w&&r({id:f,stepEl:l,offsetVal:d}),l.forEach(function(e,t){return e.setAttribute("data-scrollama-index",t)}),_=l.map(function(){return{direction:null,state:null}}),C={direction:null,state:null},q(),R(!0),X):(console.error("scrollama error: no step elements"),X)},X.resize=function(){return q(),X},X.enable=function(){return R(!0),X},X.disable=function(){return R(!1),X},X.destroy=function(){R(!1),Object.keys(o).forEach(function(e){return o[e]=null}),Object.keys(c).forEach(function(e){return c[e]=null})},X.offsetTrigger=function(e){return e&&(isNaN(e),1)?(d=Math.min(Math.max(0,e),1),X):d},X.onStepEnter=function(e){return o.stepEnter=e,X},X.onStepExit=function(e){return o.stepExit=e,X},X.onStepProgress=function(e){return o.stepProgress=e,X},X.onContainerEnter=function(e){return o.containerEnter=e,X},X.onContainerExit=function(e){return o.containerExit=e,X},X}});
